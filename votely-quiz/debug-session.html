<!DOCTYPE html>
<html>
<head>
    <title>Debug Session Storage</title>
    <style>
        body { font-family: monospace; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .session { background: #f5f5f5; padding: 15px; margin: 10px 0; border-left: 4px solid #6b46c1; }
        .error { background: #ffebee; padding: 15px; margin: 10px 0; border-left: 4px solid #f44336; }
        .success { background: #e8f5e9; padding: 15px; margin: 10px 0; border-left: 4px solid #4caf50; }
        pre { background: white; padding: 10px; overflow-x: auto; border: 1px solid #ddd; }
        button { padding: 8px 15px; background: #6b46c1; color: white; border: none; cursor: pointer; margin: 5px; }
        button:hover { background: #553c9a; }
    </style>
</head>
<body>
    <h1>üîç Debug Session Storage</h1>
    
    <button onclick="checkAllStorage()">Check All Storage</button>
    <button onclick="checkSpecificSession()">Check Specific Session</button>
    <button onclick="clearAll()">Clear All Storage</button>
    <button onclick="createTestSession()">Create Test Session</button>
    
    <div id="results"></div>
    
    <script>
        function checkAllStorage() {
            const results = document.getElementById('results');
            let html = '<h2>Storage Contents:</h2>';
            
            // Check sessionStorage
            html += '<div class="session"><h3>SessionStorage:</h3>';
            const sessionData = sessionStorage.getItem('votely_quiz_session');
            if (sessionData) {
                try {
                    const parsed = JSON.parse(sessionData);
                    html += `<p>Found session: ${parsed.sessionId}</p>`;
                    html += `<pre>${JSON.stringify(parsed, null, 2)}</pre>`;
                } catch (e) {
                    html += `<p class="error">Error parsing sessionStorage: ${e}</p>`;
                }
            } else {
                html += '<p>No session in sessionStorage</p>';
            }
            html += '</div>';
            
            // Check localStorage
            html += '<div class="session"><h3>LocalStorage:</h3>';
            const allSessions = localStorage.getItem('votely_quiz_session_all');
            if (allSessions) {
                try {
                    const parsed = JSON.parse(allSessions);
                    const sessionCount = Object.keys(parsed).length;
                    html += `<p>Found ${sessionCount} sessions in localStorage:</p>`;
                    
                    Object.entries(parsed).forEach(([id, session]) => {
                        html += `<div class="session">`;
                        html += `<h4>${id}</h4>`;
                        html += `<p>Type: ${session.type}, Questions: ${session.questions?.length || 0}, Answers: ${Object.keys(session.answers || {}).length}</p>`;
                        html += `<details><summary>View Full Session</summary><pre>${JSON.stringify(session, null, 2)}</pre></details>`;
                        html += `</div>`;
                    });
                } catch (e) {
                    html += `<p class="error">Error parsing localStorage: ${e}</p>`;
                }
            } else {
                html += '<p>No sessions in localStorage</p>';
            }
            html += '</div>';
            
            results.innerHTML = html;
        }
        
        function checkSpecificSession() {
            const sessionId = prompt('Enter session ID (e.g., quiz_1754510309460_test):');
            if (!sessionId) return;
            
            const results = document.getElementById('results');
            let html = `<h2>Checking session: ${sessionId}</h2>`;
            
            // Check sessionStorage
            const sessionData = sessionStorage.getItem('votely_quiz_session');
            if (sessionData) {
                try {
                    const parsed = JSON.parse(sessionData);
                    if (parsed.sessionId === sessionId) {
                        html += '<div class="success">‚úÖ Found in sessionStorage!</div>';
                        html += `<pre>${JSON.stringify(parsed, null, 2)}</pre>`;
                    }
                } catch (e) {}
            }
            
            // Check localStorage
            const allSessions = localStorage.getItem('votely_quiz_session_all');
            if (allSessions) {
                try {
                    const parsed = JSON.parse(allSessions);
                    if (parsed[sessionId]) {
                        html += '<div class="success">‚úÖ Found in localStorage!</div>';
                        html += `<pre>${JSON.stringify(parsed[sessionId], null, 2)}</pre>`;
                    } else {
                        html += '<div class="error">‚ùå Not found in localStorage</div>';
                        html += '<p>Available sessions:</p>';
                        html += '<ul>';
                        Object.keys(parsed).forEach(id => {
                            html += `<li>${id}</li>`;
                        });
                        html += '</ul>';
                    }
                } catch (e) {
                    html += `<div class="error">Error: ${e}</div>`;
                }
            }
            
            results.innerHTML = html;
        }
        
        function clearAll() {
            if (confirm('Clear all session storage?')) {
                sessionStorage.clear();
                localStorage.removeItem('votely_quiz_session_all');
                alert('All storage cleared!');
                checkAllStorage();
            }
        }
        
        function createTestSession() {
            const sessionId = `quiz_${Date.now()}_debug`;
            const session = {
                sessionId: sessionId,
                type: 'long',
                questions: [
                    { id: 1, originalId: 'P01', text: 'Test question', axis: 'economic', agreeDir: -1, phase: 1, qType: 'core' }
                ],
                answers: { 1: 0.5 },
                createdAt: Date.now()
            };
            
            // Save to both storages
            sessionStorage.setItem('votely_quiz_session', JSON.stringify(session));
            
            const allSessions = JSON.parse(localStorage.getItem('votely_quiz_session_all') || '{}');
            allSessions[sessionId] = session;
            localStorage.setItem('votely_quiz_session_all', JSON.stringify(allSessions));
            
            alert(`Created test session: ${sessionId}`);
            checkAllStorage();
        }
        
        // Check on load
        checkAllStorage();
    </script>
</body>
</html>